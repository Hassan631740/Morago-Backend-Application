# Railway Environment Variable Fix

## üî¥ Current Issue

Your Railway deployment is failing because placeholder values are set instead of actual values in environment variables.

## ‚ö†Ô∏è Environment Variables to Update in Railway

Go to: Railway Dashboard ‚Üí Your Service ‚Üí Variables

### 1. Fix SOCKETIO_PORT ‚úÖ (Already Fixed)
- **Variable**: `SOCKETIO_PORT`
- **Current Value**: `your-socketio-port` ‚ùå
- **Change To**: `9092` ‚úÖ

### 2. Fix JWT_EXPIRATION_MS
- **Variable**: `JWT_EXPIRATION_MS`  
- **Current Value**: `your-jwt-expiration-ms` ‚ùå
- **Change To**: `86400000` ‚úÖ (or `3600000` for 1 hour)

### 3. Fix JWT_EXPIRATION
- **Variable**: `JWT_EXPIRATION`
- **Current Value**: Check if it's `your-jwt-expiration` ‚ùå
- **Change To**: `86400000` ‚úÖ (or `3600000` for 1 hour)

### 4. Verify SECURITY_JWT_SECRET
- **Variable**: `SECURITY_JWT_SECRET`
- **Should Be**: A long base64 string (at least 64 characters)
- **Generate with**: `openssl rand -base64 64`
- **Should NOT contain**: "your-secret", "placeholder", etc. ‚ùå

---

## üìù Complete Environment Variables List

Here are all the environment variables you should have in Railway:

```bash
# Spring Profile
SPRING_PROFILES_ACTIVE=railway

# Database (Auto-generated by Railway MySQL)
DATABASE_URL=jdbc:mysql://${{MYSQLHOST}}:${{MYSQLPORT}}/${{MYSQLDATABASE}}?useSSL=true&allowPublicKeyRetrieval=true&serverTimezone=UTC
DB_USERNAME=${{MYSQLUSER}}
DB_PASSWORD=${{MYSQLPASSWORD}}
DB_DRIVER=com.mysql.cj.jdbc.Driver
DB_DIALECT=org.hibernate.dialect.MySQLDialect

# JWT Security (IMPORTANT: Use actual values!)
JWT_EXPIRATION=86400000
JWT_EXPIRATION_MS=86400000
SECURITY_JWT_SECRET=<generate-with-openssl-rand-base64-64>

# Socket.IO (Use actual numbers!)
SOCKETIO_HOST=0.0.0.0
SOCKETIO_PORT=9092
SOCKETIO_ALLOWED_ORIGINS=*

# File Upload
MAX_FILE_SIZE=10MB
MAX_REQUEST_SIZE=10MB
```

---

## üöÄ Quick Fix Steps

1. **Go to Railway Dashboard**
   - Visit https://railway.app
   - Select your project
   - Click on your service (morago-backend)

2. **Go to Variables Tab**
   - Click "Variables" in the left sidebar

3. **Update Each Variable**
   - For each variable listed above that has a placeholder value:
     - Click the edit icon (pencil)
     - Change the value to the correct one
     - Click "Save"

4. **Redeploy**
   - Railway automatically redeploys when you save variables
   - Wait 2-5 minutes for the new deployment

5. **Verify**
   - Check the deployment logs
   - Look for "Started MoragoBackendApplication" at the end
   - No errors should appear

---

## üéØ Generate a Secure JWT Secret

If you need to generate a new JWT secret:

```bash
openssl rand -base64 64
```

Copy the output and set it as `SECURITY_JWT_SECRET` in Railway.

---

## ‚úÖ Verification Checklist

After updating variables, verify:

- [ ] All placeholder values are replaced with actual values
- [ ] No variable contains "your-", "placeholder", or similar text
- [ ] SOCKETIO_PORT is a number (like 9092)
- [ ] JWT_EXPIRATION_MS is a number (like 86400000)
- [ ] SECURITY_JWT_SECRET is a long base64 string
- [ ] Deployment completes successfully
- [ ] Health check returns: `{"status":"UP"}`

---

## üîç How to Check Current Variables

1. Railway Dashboard ‚Üí Your Service ‚Üí Variables
2. Look for variables that contain:
   - "your-" prefix
   - "placeholder"
   - Non-numeric values in numeric fields
   - Any incomplete or example values

Replace ALL of them with actual values!

---

## üìö Values Reference

| Variable | Type | Example Value | Notes |
|----------|------|---------------|-------|
| `SOCKETIO_PORT` | Number | `9092` | Port for Socket.IO server |
| `JWT_EXPIRATION_MS` | Number | `86400000` | JWT expiration in milliseconds (86400000 = 24 hours) |
| `JWT_EXPIRATION` | Number | `86400000` | Same as above |
| `SECURITY_JWT_SECRET` | String (Base64) | 64+ character string | Generated via openssl |
| `SOCKETIO_HOST` | String | `0.0.0.0` | Host binding |
| `SOCKETIO_ALLOWED_ORIGINS` | String | `*` | CORS origins |

---

## üÜò Still Not Working?

1. **Check Deployment Logs**
   - Railway ‚Üí Deployments ‚Üí Latest ‚Üí View Logs
   - Look for specific error messages
   - The improved error handling will tell you exactly which variable is wrong

2. **Compare Variables**
   - Export your Railway variables
   - Compare with the template above
   - Make sure every placeholder is replaced

3. **Test Locally**
   ```bash
   # Test with the same variables
   export SPRING_PROFILES_ACTIVE=railway
   export SOCKETIO_PORT=9092
   export JWT_EXPIRATION_MS=86400000
   # ... etc
   mvn spring-boot:run
   ```

---

**Replace all placeholder values with actual values and redeploy!** üöÄ

